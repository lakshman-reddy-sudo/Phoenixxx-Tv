<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PhoenixxxTv Fancode Live</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&display=swap" />

<!-- JW Player -->
<script src="https://cdn.jwplayer.com/libraries/IDzF9Zmk.js"></script>

<style>
:root{
  --bg-color:#222; --text-color:#fff; --match-bg:#333;
  --btn-primary-bg:#ff6600; --btn-primary-hover-bg:#cc5500; --btn-primary-text:#fff;
  --status-live-color:#00ff00;
  --title-color:#ff6600; --subtitle-color:#ffcc00;
}

/* Page layout */
body{ margin:0; padding:20px; font-family:'Roboto',sans-serif; background:var(--bg-color); color:var(--text-color); text-align:center; }

/* Player container */
#player-wrapper {
  max-width: 90%;
  margin: 10px auto 25px auto;
  display: none;
}
.player-embed {
  width: 100%;
  aspect-ratio: 16/9;
  border-radius: 10px;
  overflow: hidden;
  background: #000;
  box-shadow:0 0 12px rgba(0,0,0,0.5);
}
#dynamic-player { width:100%; height:100%; }

/* Tabs */
.tabs { display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-bottom:18px; }
.tab-btn {
  background:#444; border:0; color:#fff;
  padding:10px 16px; border-radius:20px;
  cursor:pointer; font-weight:600;
}
.tab-btn.active { background:var(--btn-primary-bg); color:#111; }

/* Match grid */
.file-container{ display:flex; flex-wrap:wrap; gap:15px; justify-content:center; margin-top:20px; }
.match-item{ background:var(--match-bg); border-radius:10px; padding:15px; width:280px; cursor:pointer; position:relative; }
.match-item img{ width:100%; border-radius:8px; }
.badge { position:absolute; top:8px; padding:4px 8px; border-radius:6px; font-size:0.8rem; }
.badge-category{ left:8px; background:#555; }
.badge-status{ right:8px; background:#e53935; }
.match-details h3{ margin:6px 0; }
.stream-button{
  margin-top:8px; background:var(--btn-primary-bg); border:none;
  padding:12px; border-radius:8px; color:#fff; cursor:pointer; font-weight:700;
}
.stream-button.disabled{ background:#555; cursor:not-allowed; }
.live-dot{ width:10px; height:10px; border-radius:50%; background:var(--status-live-color); display:inline-block; margin-right:6px; }
</style>
</head>

<body>

<h1>PhoenixxxTv Fancode Live</h1>
<h2>Made with‚ô•Ô∏è by Lakshman</h2>

<!-- Tabs -->
<div class="tabs" id="tabs">
  <button type="button" class="tab-btn active" data-filter="all">All</button>
  <button type="button" class="tab-btn" data-filter="LIVE">Live</button>
  <button type="button" class="tab-btn" data-filter="UPCOMING">Upcoming</button>
</div>

<!-- Player (JW) -->
<div id="player-wrapper">
  <div class="player-embed">
    <div id="dynamic-player"></div>
  </div>
</div>

<!-- Matches -->
<div class="file-container" id="matches"></div>

<footer>¬©Lakshman 2025 | All Rights Reserved</footer>


<script>
// üî• Don't touch proxy, you wanted same
const proxyBaseURL = 'https://my-hls-worker.lakshman-n-hlc0596.workers.dev/ios=';

// üî• Fancode source
const apiURL = 'https://raw.githubusercontent.com/drmlive/fancode-live-events/main/fancode.json';

// Variables
let allMatches = [];
let currentFilter = 'all';
let activeStreamLink = null;
let jwPlayerInstance = null;

// Extract workable link
function getStreamLink(match){
  if(match.dai_url) return match.dai_url;
  if(match.url) return match.url;
  if(match.stream?.url) return match.stream.url;
  return null;
}

// Render cards
function renderMatches(){
  const container = document.getElementById("matches");
  container.innerHTML = "";

  let filtered = currentFilter === "all" ? allMatches :
    allMatches.filter(m => (m.status||'').toUpperCase() === currentFilter);

  filtered.forEach(match => {
    const div = document.createElement("div");
    div.className = "match-item";

    const img = match.src || "https://via.placeholder.com/400x225?text=No+Image";
    const status = (match.status || "N/A").toUpperCase();
    const hasStream = !!getStreamLink(match);

    div.innerHTML = `
      <span class="badge badge-category">${match.event_category||'Match'}</span>
      <span class="badge badge-status">${status}</span>
      <img src="${img}" />
      <div class="match-details">
        <h3>${match.title||"Match"}</h3>
        <button class="stream-button ${hasStream?'':'disabled'}">
          ${status==="LIVE"&&hasStream?'<span class="live-dot"></span>':''}
          ${hasStream?'Watch Now':'No Stream'}
        </button>
      </div>
    `;

    // Play click
    div.onclick = ()=>{
      if(!hasStream) return;
      playJW(match);
    };

    container.appendChild(div);
  });
}

// JW Player logic
function playJW(match){
  const link = getStreamLink(match);
  if(!link) return;

  // JW needs DIRECT stream ‚Üí DO NOT modify proxyBaseURL
  const streamUrl = link;

  document.getElementById("player-wrapper").style.display = "block";

  if(!jwPlayerInstance){
    jwPlayerInstance = jwplayer("dynamic-player").setup({
      file: streamUrl,
      autostart: true,
      hlshtml: true,
      width: "100%",
      height: "100%",
      primary: "html5",
      controls: true,

      // DVR seek (live rewind)
      liveSyncDuration: 30,
      dvrSeekLimit: 1800,
      playbackRateControls: true
    });

    jwPlayerInstance.on("error", e=>{
      console.log("JW Error:",e);
    });

  } else {
    jwPlayerInstance.load([{ file: streamUrl }]);
    jwPlayerInstance.play(true);
  }

  document.getElementById("player-wrapper").scrollIntoView({behavior:"smooth"});
}

// Fetch live data
async function fetchMatches(){
  const resp = await fetch(apiURL);
  const data = await resp.json();
  allMatches = data.matches;
  renderMatches();
}

// Tabs behavior
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".tab-btn").forEach(x=>x.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.dataset.filter;
    renderMatches();
  };
});

// Load
fetchMatches();
setInterval(fetchMatches,180000);

</script>

</body>
</html>
