<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PhoenixxxTv SonyLiv Live</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0f172a;
      --secondary: #1e293b;
      --accent: #38bdf8;
      --text: #f1f5f9;
      --muted: #94a3b8;
      --danger: #ef4444;
      --success: #22c55e;
    }
    body {
      background: var(--primary);
      color: var(--text);
      margin: 0;
      font-family: Arial, sans-serif;
    }
    header {
      text-align: center;
      padding: 15px 10px;
      background: var(--secondary);
      font-size: 1.5rem;
      font-weight: bold;
    }
    .filters {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 15px 0;
    }
    .filter-btn {
      padding: 5px 10px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
    }
    .matches {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      padding: 10px;
    }
    .card {
      background: var(--secondary);
      border-radius: 10px;
      width: 220px;
      overflow: hidden;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    .card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
    }
    .watch-btn {
      display: inline-block;
      margin: 10px 0;
      padding: 5px 12px;
      background: var(--success);
      color: #fff;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
    }
    .live-dot {
      width: 8px;
      height: 8px;
      background: var(--success);
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <header>PhoenixxxTv SonyLiv Live</header>

  <div class="filters">
    <button class="filter-btn" onclick="filterMatches('all')">All</button>
    <button class="filter-btn" onclick="filterMatches('live')">Live</button>
    <button class="filter-btn" onclick="filterMatches('upcoming')">Upcoming</button>
  </div>

  <div id="matches" class="matches"></div>

  <script>
    let allMatches = [];
    let currentFilter = "all";

    async function loadMatches() {
      try {
        const res = await fetch("https://raw.githubusercontent.com/drmlive/sliv-live-events/main/sonyliv.json");
        const data = await res.json();
        allMatches = data.matches || data.events || data.data || [];
        renderMatches();
      } catch (err) {
        console.error("Error fetching matches:", err);
        document.getElementById("matches").innerHTML =
          `<p style="text-align:center;color:#f43f5e;">⚠️ Unable to load events.</p>`;
      }
    }

    function renderMatches() {
      const container = document.getElementById("matches");
      container.innerHTML = "";
      let filtered = allMatches;

      if (currentFilter === "live") {
        filtered = allMatches.filter(m => m.isLive);
      } else if (currentFilter === "upcoming") {
        filtered = allMatches.filter(m => !m.isLive);
      }

      if (!filtered.length) {
        container.innerHTML = `<p style="color:#94a3b8;text-align:center;">No ${currentFilter} matches available</p>`;
        return;
      }

      filtered.forEach(match => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${match.image}" alt="${match.match_name}">
          <h3>${match.match_name}</h3>
          <a class="watch-btn" href="player.html?url=${encodeURIComponent(getStreamLink(match))}">
            <span class="live-dot"></span>Watch
          </a>`;
        container.appendChild(card);
      });
    }

    function getStreamLink(match) {
      return match.dai_url || match.pub_url || match.video_url || match.url || "#";
    }

    function filterMatches(filter) {
      currentFilter = filter;
      renderMatches();
    }

    // First load
    loadMatches();

    // Auto-refresh every 3 minutes
    setInterval(loadMatches, 180000);
  </script>
</body>
</html>  color:var(--subtitle-color);
  word-wrap:break-word;
}

/* Dynamic player */
#player-wrapper {
  max-width: 70%;
  margin: 10px auto 25px auto;
  display: none;
}
#player-wrapper .player-embed {
  position: relative;
  padding-bottom: 40%; /* desktop ratio */
  height: 0;
  overflow: hidden;
  max-width: 100%;
  border-radius: 10px;
  box-shadow: 0 0 12px rgba(0,0,0,0.5);
}
#player-wrapper iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}

/* Mobile adjustments */
@media(max-width:480px){
  #player-wrapper {
    max-width: 95%;
  }
  #player-wrapper .player-embed {
    padding-bottom: 56%; /* taller ratio for mobile */
  }
}

/* Matches */
.file-container{
  display:flex;
  flex-wrap:wrap;
  gap:15px;
  justify-content:center;
  margin-top:20px;
}

.match-item{
  background-color:var(--match-bg);
  border-radius:10px;
  padding:15px;
  width:calc(25% - 20px);
  min-width:250px;
  box-shadow:0 0 10px rgba(0,0,0,0.3);
  cursor:pointer;
  transition:transform 0.3s ease,box-shadow 0.3s ease;
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  align-items:center;
  min-height:400px;
}

@media(max-width:1024px){.match-item{width:calc(33.333% - 20px);}}
@media(max-width:768px){.match-item{width:calc(50% - 20px);}}
@media(max-width:480px){.match-item{width:100%;}}

.match-item img{width:100%;height:auto;border-radius:8px;}

.match-details{
  margin-top:10px;
  text-align:center;
  width:100%;
  display:flex;
  flex-direction:column;
  align-items:center;
  flex-grow:1;
}

.match-details h3{
  margin:5px 0;
  font-family:'Montserrat',sans-serif;
  font-weight:700;
  font-size:1.1em;
  text-align:center;
  word-wrap:break-word;
}

.match-time-button{
  display:flex;
  flex-direction:column;
  width:100%;
  gap:8px;
  margin-top:auto;
}

.match-details p{
  margin:0;
  font-size:0.9em;
  word-wrap:break-word;
}

.stream-button{
  padding:12px 0;
  background-color:var(--btn-primary-bg);
  color:var(--btn-primary-text);
  border:none;
  border-radius:8px;
  font-family:'Montserrat',sans-serif;
  font-weight:700;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  width:100%;
  min-height:50px;
  gap:8px;
  transition:background-color 0.3s;
}
.stream-button:hover:not(.disabled){background-color:var(--btn-primary-hover-bg);}
.stream-button.disabled{
  background-color:#555;
  cursor:not-allowed;
  color:#aaa;
}

/* Green live dot */
.stream-button .live-dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  background-color: var(--status-live-color);
  animation: pulse 1.5s infinite;
}
@keyframes pulse {
  0% { transform: scale(0.9); opacity: 0.7; }
  50% { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(0.9); opacity: 0.7; }
}

footer{width:100%;text-align:center;padding:20px 10px 24px 10px;background-color:#111;color:#fff;font-family:'Montserrat',sans-serif;margin-top:40px;}
</style>
</head>
<body>

<h1>PhoenixxxTv Fancode Live</h1>
<h2>Made with ♥️ by Lakshman</h2>

<!-- Dynamic player -->
<div id="player-wrapper">
  <div class="player-embed">
    <iframe id="dynamic-player" webkitAllowFullScreen mozallowfullscreen allowfullscreen frameborder="0" allow="autoplay"></iframe>
  </div>
</div>

<div class="file-container" id="matches"></div>

<footer>©Lakshman 2025 | All Rights Reserved</footer>

<script>
const apiURL = 'https://raw.githubusercontent.com/drmlive/fancode-live-events/main/fancode.json';
const container = document.getElementById('matches');
const playerWrapper = document.getElementById('player-wrapper');
const playerIframe = document.getElementById('dynamic-player');
const proxyBaseURL = 'https://anym3u8player.com/tv/p.php?url=';

function getStreamLink(match){
  if(match.dai_url) return match.dai_url;
  if(match.url) return match.url;
  if(match.stream && match.stream.url) return match.stream.url;
  return null;
}

// Render matches dynamically
function renderMatches(data){
  container.innerHTML = '';
  if(!data.matches || !data.matches.length){
    container.textContent = "No matches available right now.";
    return;
  }

  data.matches.forEach(match => {
    const div = document.createElement('div');
    div.className = 'match-item';

    const imgUrl = match.src || 'https://via.placeholder.com/300x200?text=No+Image';
    const statusLive = match.status && match.status.toLowerCase() === 'live';
    const hasStream = !!getStreamLink(match);
    const startTimeDisplay = (match.startTime || match.start_date) 
      ? `<p>Start Time: ${match.startTime || match.start_date}</p>` : '';

    div.innerHTML = `
      <img src="${imgUrl}" alt="${match.title || 'Match Image'}">
      <div class="match-details">
        <h3>${match.title || 'Match Title'}</h3>
        <div class="match-time-button">
          ${startTimeDisplay}
          <button class="stream-button ${hasStream?'':'disabled'}" ${hasStream?'':'disabled'}>
            ${statusLive && hasStream ? '<div class="live-dot"></div>' : ''} 
            ${hasStream ? 'Watch Now' : 'No Stream'}
          </button>
        </div>
      </div>
    `;

    const btn = div.querySelector('.stream-button');
    if(hasStream){
      btn.addEventListener('click', e => {
        e.stopPropagation();
        const link = getStreamLink(match);
        if(link){
          playerIframe.src = proxyBaseURL + encodeURIComponent(link);
          playerWrapper.style.display = 'block';
          playerWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    }

    container.appendChild(div);
  });
}

// Fetch matches & refresh links every 3 mins without affecting current player
async function fetchAndRender(){
  try{
    const resp = await fetch(apiURL, {cache:'no-cache'});
    const data = await resp.json();
    renderMatches(data);
  }catch(err){
    console.error(err);
    container.textContent = "Failed to fetch live matches.";
  }
}

fetchAndRender();
setInterval(fetchAndRender, 180000); // refresh every 3 minutes
</script>

</body>
</html>
